@page "/signin"
@inject HttpClient Http
@inject NavigationManager NavManager

<div class="container">
    <h3>SignIn</h3>
    <hr />
    <EditForm Model="@signIn" OnSubmit="@SignInAsync">
        <div class="form-group w-25">
            <input type="text" class="form-control" placeholder="FirstName" @bind="signIn.Email" required />
        </div>
        <div class="form-group w-25">
            <input type="text" class="form-control" placeholder="LastName" @bind="signIn.Password" required />
        </div>

        <hr />
        <div class="form-group w-25">
            <button type="submit" class="btn btn-primary">LogIn</button>
        </div>
    </EditForm>
</div>

@code {
    private SignIn signIn;
    private HttpResponseMessage result;

    private async Task SignInAsync()
    {

        result = await Http.PostAsJsonAsync<SignIn>("https://localhost:44350/api/users/signin",
            new SignIn { Email = signIn.Email, Password = signIn.Password });

        var data = JsonConvert.DeserializeObject<dynamic>(await result.Content.ReadAsStringAsync());



        Http.DefaultRequestHeaders.Add("Authorization", $"Bearer {data.accessToken}");
        NavManager.NavigateTo("/");

    }

    protected override void OnInitialized()
    {
        signIn = new SignIn();
    }
}
